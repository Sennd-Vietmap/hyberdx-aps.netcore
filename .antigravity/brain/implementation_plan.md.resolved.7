# Phase 4: Full Stack Visibility

This final phase completes the observability loop by adding visibility into the infrastructure (ClickHouse) and deep application performance (Profiling).

## User Review Required

> [!IMPORTANT]
> To monitor ClickHouse, we will use the `clickhouse` receiver in the OTel Collector. This requires the collector to have network access to the ClickHouse port (8123).

## Proposed Changes

### 1. Database Observability (ClickHouse)

#### [MODIFY] [otel-collector-config.yaml](file:///d:/study/google-antigravity/clickstack-aspnet/otel-collector-config.yaml)
- Add the `clickhouse` receiver.
- Configure it to point to `clickstack-observability:8123`.
- Update the metrics pipeline to include this receiver.

### 2. Continuous Profiling & RUM Guides

#### [NEW] [PROFILING_GUIDE.md](file:///d:/study/google-antigravity/clickstack-aspnet/PROFILING_GUIDE.md)
Explain how to use **OpenTelemetry DotNet Profiling** (experimental/contribution) to identify CPU and Memory bottlenecks at the line-of-code level.

#### [NEW] [FRONTEND_RUM_GUIDE.md](file:///d:/study/google-antigravity/clickstack-aspnet/FRONTEND_RUM_GUIDE.md)
Provide a step-by-step template for adding the **HyperDX Browser SDK** to a React or Next.js application, including session replay and correlation with backend traces.

---

## Verification Plan

### Automated Tests
- None.

### Manual Verification
1. **Collector Logs**: Verify that the OTel Collector successfully connects to the ClickHouse endpoint.
2. **Metric Verification**: Check HyperDX for ClickHouse-specific metrics like `clickhouse.query.count` or `clickhouse.table.size`.
3. **Guide Review**: Ensure the RUM and Profiling guides are actionable and up-to-date with OTel standards.
